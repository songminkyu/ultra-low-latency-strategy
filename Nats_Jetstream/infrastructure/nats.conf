server_name: nats-production-01
server_tags: [
    "env:production",
    "region:seoul",
    "tier:messaging"
]

host: 0.0.0.0 # 모든 네트워크 인터페이스에서 연결을 받겠다는 의미
port: 4222 # 표준 연결 포트

max_connections: 5000 # 연결 하나당 대략 10KB 메모리 필요 -> 최대 50MB 사용
max_payload: 1048576 #  1MB -> 하나의 메시지가 가질 수 있는 최대 크기
max_pending: 67108864 # 64MB -> 쌓아둘 수 있는 메시지의 최대 크기

ping_interval: "2m" # 2분마다 연결된 모든 클라이언트에게 PING
ping_max: 2 # PONG 오지 않는 상황에 대한 일종의 retry 정책
write_deadline: "10s" # 서버가 클라이언트에게 데이터를 보낼 떄 특정 시간안에 전송을 보장

jetstream {
    store_dir: /data/jetstream # 데이터를 저장하는 경로
    max_memory_store: 10GB
    max_file_store: 100GB
}

debug: false
logtime: true
log_file: "/data/nats-server.log"

# authorization {
#    users: [
#        {
#            user: admin
#            password: $ADMIN_PASSWORD
#            permissions {
#                publish = { allow: [">"] }
#                subscribe = { allow: [">"] }
#            }
#        }
#        {
#            user: service_api
#            password: $API_PASSWORD
#            permissions {
#                publish = { allow: ["api.>", "events.>"] }
#                subscribe = { allow: ["api.>", "_INBOX.>"] }
#            }
#        }
#        {
#            user: service_worker
#            password: $WORKER_PASSWORD
#            permissions {
#                publish = { allow: ["tasks.results.>", "events.>"] }
#                subscribe = { allow: ["tasks.queue.>"] }
#            }
#        }
#    ]
# }

http_port: 8222 # http://localhost:8222/varz, /connz, /jsz

lame_duck_duration: "2m"